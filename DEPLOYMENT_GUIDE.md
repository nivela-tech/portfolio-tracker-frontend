# Portfolio Tracker Deployment Configuration

## Build and Deploy Scripts

This workspace includes two scripts for building the frontend and preparing it for deployment:

### 1. PowerShell Script (Recommended)
**File:** `build-and-deploy.ps1`

**Features:**
- Comprehensive error handling and validation
- Colored output for better visibility
- Flexible command-line options
- Detailed progress reporting
- Prerequisites checking

**Usage:**
```powershell
# Full build and deploy
.\build-and-deploy.ps1

# Clean existing files and rebuild
.\build-and-deploy.ps1 -Clean

# Skip build step (use existing build)
.\build-and-deploy.ps1 -SkipBuild

# Verbose output for debugging
.\build-and-deploy.ps1 -Verbose

# Show help
.\build-and-deploy.ps1 -Help
```

### 2. Batch Script (Simple Alternative)
**File:** `build-and-deploy.bat`

**Features:**
- Simple and straightforward
- Works on any Windows system
- No parameters needed
- Automatic pause at end

**Usage:**
```cmd
build-and-deploy.bat
```

## Deployment Process

Both scripts perform the following steps:

1. **Prerequisites Check** (PowerShell only)
   - Verify Node.js and npm are installed
   - Check directory structure
   - Validate package.json exists

2. **Install Dependencies**
   - Run `npm install` in frontend directory
   - Ensure all packages are up to date

3. **Build Frontend**
   - Set `NODE_ENV=production`
   - Run `npm run build`
   - Generate optimized production build

4. **Prepare Backend**
   - Create static resources directory if needed
   - Optionally clean existing files

5. **Copy Files**
   - Copy all build output to backend static directory
   - Verify successful copy operation

## Directory Structure

```
workspace/
├── portfolio-tracker-frontend/
│   ├── build/                 # Generated by npm run build
│   │   ├── index.html
│   │   ├── static/
│   │   │   ├── css/
│   │   │   └── js/
│   │   └── ...
│   └── ...
└── portfolio-tracker-backend/
    └── src/main/resources/
        └── static/            # Destination for frontend files
            ├── index.html
            ├── static/
            └── ...
```

## Backend Configuration

The Spring Boot backend is configured to serve static files from `src/main/resources/static/`. This is automatically handled by Spring Boot's default static resource handling.

### Key Configuration Points:

1. **SecurityConfig.java** - Allows public access to static resources:
   ```java
   .requestMatchers("/", "/index.html", "/static/**", "/manifest.json", "/favicon.ico", "/logo*.png", "/robots.txt").permitAll()
   ```

2. **SPA Routing** - The backend should have a controller to handle SPA routing:
   ```java
   @Controller
   public class SpaController {
       @RequestMapping(value = "/{path:[^\\.]*}")
       public String redirect() {
           return "forward:/";
       }
   }
   ```

## Production Deployment

After running the build script:

1. **Local Testing:**
   ```bash
   cd portfolio-tracker-backend
   ./gradlew bootRun
   ```
   Visit: http://localhost:8080

2. **Railway Deployment:**
   ```bash
   cd portfolio-tracker-backend
   ./deploy-railway.ps1
   ```

3. **Docker Deployment:**
   ```bash
   cd portfolio-tracker-backend
   docker build -t portfolio-tracker .
   docker run -p 8080:8080 portfolio-tracker
   ```

## Environment Variables

Make sure these environment variables are set for production:

### Frontend (Build Time)
- `REACT_APP_API_URL` - Backend API URL
- `REACT_APP_FRONTEND_URL` - Frontend URL (for redirects)

### Backend (Runtime)
- `SPRING_PROFILES_ACTIVE=prod`
- `GOOGLE_CLIENT_ID` - Google OAuth client ID
- `GOOGLE_CLIENT_SECRET` - Google OAuth client secret
- `DATABASE_URL` - Database connection string
- `CORS_ALLOWED_ORIGINS` - Frontend URL for CORS

## Troubleshooting

### Common Issues:

1. **Build Fails:**
   - Check Node.js and npm versions
   - Delete `node_modules` and run `npm install`
   - Check for TypeScript errors

2. **Files Not Copied:**
   - Verify build directory exists
   - Check file permissions
   - Ensure backend directory structure is correct

3. **Backend Not Serving Frontend:**
   - Verify static files are in correct location
   - Check Spring Boot static resource configuration
   - Ensure SPA controller is configured for routing

4. **CORS Issues:**
   - Verify `CORS_ALLOWED_ORIGINS` includes frontend URL
   - Check SecurityConfig CORS configuration
   - Ensure credentials are allowed

### Debug Commands:

```powershell
# Check build output
ls portfolio-tracker-frontend/build

# Check copied files
ls portfolio-tracker-backend/src/main/resources/static

# Test backend static serving
curl http://localhost:8080/static/css/main.css

# Check environment variables
echo $env:REACT_APP_API_URL
```

## Security Considerations

1. **Static Files:** All files in the static directory are publicly accessible
2. **API Endpoints:** Ensure sensitive endpoints are properly protected
3. **Environment Variables:** Never commit sensitive values to version control
4. **HTTPS:** Use HTTPS in production for OAuth and session security
5. **CSP Headers:** Consider implementing Content Security Policy headers
